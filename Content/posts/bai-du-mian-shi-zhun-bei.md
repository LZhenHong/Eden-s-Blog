---
title: ç™¾åº¦é¢è¯•å‡†å¤‡
date: 2016-11-10 16:12
tags: iOS
published: true
hideInList: false
feature: 
isTop: false
---
**ç”³æ˜ï¼šä»¥ä¸‹çŸ¥è¯†ç‚¹å‡æ¥è‡ªç½‘ç»œï¼Œæ¥æºå‡åœ¨æ¯èŠ‚æœ€å‰é¢ç»™å‡ºï¼Œä¾µåˆ ã€‚**
**æ„Ÿè°¢æ„¿æ„åˆ†äº«çŸ¥è¯†çš„äºº ğŸ™ğŸ™ï¼Œæ˜¯ä»–ä»¬è®©æˆ‘ä»¬å­¦ä¹ äº†æ›´å¤šæ›´å¥½çš„çŸ¥è¯†ã€‚**

å‰ä¸€æ®µæ—¶é—´å‡†å¤‡ç™¾åº¦é¢è¯•æ€»ç»“çš„ä¸€äº›çŸ¥è¯†ç‚¹ï¼Œ~~è™½ç„¶é¢è¯•æ²¡è¿‡ ğŸ˜­ğŸ˜­~~ æŠŠè¿™äº›ä¸œè¥¿è®°å½•ä¸‹æ¥ï¼Œä¹Ÿæ–¹ä¾¿è‡ªå·±ä»¥åæŸ¥çœ‹ã€‚

<!-- more -->

## `+ load` æ–¹æ³•ç†è§£
> [ä½ çœŸçš„äº†è§£ load æ–¹æ³•ä¹ˆï¼Ÿ][1]
> ã€ŒEffective Objective-Cã€Page 200

æ–‡ç« ä»‹ç»çš„å¾ˆè¯¦ç»†ï¼Œæ¨èé˜…è¯»ï¼Œä½†å¯¹é¢è¯•æ¥è¯´ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“ä¸‹é¢çš„çŸ¥è¯†åº”è¯¥å·®ä¸å¤šäº†ã€‚åŒæ—¶ `Effective Objective-C` è¿™æœ¬ä¹¦çš„ç¬¬ 51 æ¡ä¹Ÿä»‹ç»äº† `+ load` æ–¹æ³•ã€‚

load ä½œä¸º Objective-C ä¸­çš„ä¸€ä¸ªæ–¹æ³•ï¼Œä¸å…¶å®ƒæ–¹æ³•æœ‰å¾ˆå¤§çš„ä¸åŒã€‚å®ƒåªæ˜¯ä¸€ä¸ªåœ¨æ•´ä¸ªæ–‡ä»¶è¢«åŠ è½½åˆ°è¿è¡Œæ—¶ï¼Œåœ¨ main å‡½æ•°è°ƒç”¨ä¹‹å‰è¢« ObjC è¿è¡Œæ—¶è°ƒç”¨çš„é’©å­æ–¹æ³•ã€‚å…¶ä¸­å…³é”®å­—æœ‰è¿™ä¹ˆå‡ ä¸ªï¼š

* æ–‡ä»¶åˆšåŠ è½½
* main å‡½æ•°ä¹‹å‰
* é’©å­æ–¹æ³•

ç”±äºå®ƒçš„è°ƒç”¨ä¸æ˜¯æƒ°æ€§çš„ï¼Œä¸”å…¶åªä¼šåœ¨ç¨‹åºè°ƒç”¨æœŸé—´è°ƒç”¨ä¸€æ¬¡ï¼Œæœ€æœ€é‡è¦çš„æ˜¯ï¼Œå¦‚æœåœ¨ç±»ä¸åˆ†ç±»ä¸­éƒ½å®ç°äº† load æ–¹æ³•ï¼Œå®ƒä»¬éƒ½ä¼šè¢«è°ƒç”¨ï¼Œä¸åƒå…¶å®ƒçš„åœ¨åˆ†ç±»ä¸­å®ç°çš„æ–¹æ³•ä¼šè¢«è¦†ç›–ã€‚

load æ–¹æ³•å¹¶ä¸åƒæ™®é€šçš„æ–¹æ³•é‚£æ ·ï¼Œå®ƒå¹¶ä¸éµä»é‚£å¥—ç»§æ‰¿è§„åˆ™ã€‚å¦‚æœæŸä¸ªç±»æœ¬èº«æ²¡å®ç° load æ–¹æ³•ï¼Œé‚£ä¹ˆä¸ç®¡å…¶å„çº§è¶…ç±»æ˜¯å¦å®ç°æ­¤æ–¹æ³•ï¼Œç³»ç»Ÿéƒ½ä¸ä¼šè°ƒç”¨ã€‚ load æ–¹æ³•è°ƒç”¨é¡ºåºï¼š

* çˆ¶ç±»å…ˆäºå­ç±»è°ƒç”¨
* ç±»å…ˆäºåˆ†ç±»è°ƒç”¨

ä¸è¦åœ¨ load æ–¹æ³•ä¸­ä½¿ç”¨å…¶ä»–ç±»ï¼Œå› ä¸ºç±»çš„è½½å…¥æˆ‘ä»¬æ˜¯ä¸èƒ½ç¡®å®šçš„ï¼Œæ‰€ä»¥ä¼šé€ æˆå®‰å…¨éšæ‚£ã€‚

load æ–¹æ³•åŠ¡å¿…å®ç°å¾—ç²¾ç®€ä¸€äº›ï¼Œä¹Ÿå°±æ˜¯è¦å°½é‡å‡å°‘å…¶æ‰€æ‰§è¡Œçš„æ“ä½œï¼Œå› ä¸ºæ•´ä¸ªåº”ç”¨ç¨‹åºåœ¨æ‰§è¡Œ load æ–¹æ³•æ—¶éƒ½ä¼šé˜»å¡ã€‚å¦‚æœ load æ–¹æ³•ä¸­åŒ…å«ç¹æ‚çš„ä»£ç ï¼Œé‚£ä¹ˆåº”ç”¨ç¨‹åºåœ¨æ‰§è¡ŒæœŸé—´å°±ä¼šå˜å¾—æ— å“åº”ã€‚ä¸è¦åœ¨é‡Œé¢ç­‰å¾…é”ï¼Œä¹Ÿä¸è¦è°ƒç”¨å¯èƒ½ä¼šåŠ é”çš„æ–¹æ³•ã€‚

å…¶çœŸæ­£ç”¨é€”ä»…åœ¨äºè°ƒè¯•ç¨‹åºï¼Œæ¯”å¦‚å¯ä»¥åœ¨åˆ†ç±»é‡Œç¼–å†™æ­¤æ–¹æ³•ï¼Œç”¨æ¥åˆ¤æ–­è¯¥åˆ†ç±»æ˜¯å¦å·²ç»æ­£ç¡®åŠ è½½ã€‚

ç”±äº `+ load` æ–¹æ³•çš„ç‰¹æ®Šæ€§ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šåœ¨ `+ load` æ–¹æ³•ä¸­è¿›è¡Œ [Method Swizzling][3] ã€‚

## `+ initialize` æ–¹æ³•ç†è§£
> [æ‡’æƒ°çš„ initialize æ–¹æ³•][2]
> ã€ŒEffective Objective-Cã€Page 202

`+ initialize` åªä¼šåœ¨å¯¹åº”ç±»çš„æ–¹æ³•ç¬¬ä¸€æ¬¡è¢«è°ƒç”¨æ—¶ï¼Œæ‰ä¼šè°ƒç”¨ã€‚å¦‚æœè¿™ä¸ªç±»ä¸€ç›´æ²¡æœ‰ä½¿ç”¨ï¼Œè¿™ä¸ªæ–¹æ³•å°±ä¸ä¼šæ‰§è¡Œã€‚

`+ initialize` æ–¹æ³•æ˜¯åœ¨ `alloc` æ–¹æ³•ä¹‹å‰æ‰§è¡Œå®Œçš„ï¼Œ`alloc` çš„è°ƒç”¨å¯¼è‡´äº†å‰è€…çš„æ‰§è¡Œã€‚

åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œè¿è¡ŒæœŸç³»ç»Ÿæ˜¯å¤„äºæ­£å¸¸çš„çŠ¶æ€ï¼Œå› æ­¤å¯ä»¥åœ¨æ­¤æ–¹æ³•ä¸­è°ƒç”¨ä»»ä½•ç±»ä¸­çš„ä»»æ„æ–¹æ³•ã€‚

`+ initialize` æ–¹æ³•åªåº”è¯¥ç”¨æ¥è®¾ç½®å†…éƒ¨æ•°æ®ã€‚ä¸åº”è¯¥è°ƒç”¨å…¶ä»–æ–¹æ³•ã€‚è‹¥æŸä¸ªå…¨å±€çŠ¶æ€æ— æ³•åœ¨ç¼–è¯‘æœŸåˆå§‹åŒ–ï¼Œå¯ä»¥æ”¾åœ¨ `+ initialize`  æ–¹æ³•ä¸­æ¥åšã€‚

```objectivec
// EOCClass.h
#import <Foundation/Foundation.h>

@interface EOCClass: NSObject
@end

// EOCClass.m
static const int kInterval = 10;
// åˆ›å»ºå®ä¾‹ä¹‹å‰å¿…é¡»å…ˆæ¿€æ´»è¿è¡ŒæœŸç³»ç»Ÿ
static NSMutableArray *kSomeObjects;

@implementation

+ (void)initialize {
    if (self == [EOCClass class]) {
        kSomeObjects = [NSMutableArray array];
    }
}

@end
```

* `+ initialize` çš„è°ƒç”¨æ˜¯æƒ°æ€§çš„ï¼Œå®ƒä¼šåœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨å½“å‰ç±»çš„æ–¹æ³•æ—¶è¢«è°ƒç”¨
* ä¸ `load` ä¸åŒï¼Œ`+ initialize` æ–¹æ³•è°ƒç”¨æ—¶ï¼Œæ‰€æœ‰çš„ç±»éƒ½å·²ç»åŠ è½½åˆ°äº†å†…å­˜ä¸­
* `+ initialize` çš„è¿è¡Œæ˜¯çº¿ç¨‹å®‰å…¨çš„
* å­ç±»ä¼šç»§æ‰¿çˆ¶ç±»çš„ `+ initialize` æ–¹æ³•ï¼Œçˆ¶ç±»çš„è°ƒç”¨å…ˆäºå­ç±»ã€‚

## runtime ç†è§£
> [Method Swizzling][3]
> [Associated Objects][4]
> [å…³è”å¯¹è±¡ AssociatedObject å®Œå…¨è§£æ][5]
> [è½»æ¾å­¦ä¹ ä¹‹ä¸€ï¼ï¼Objective-Cæ¶ˆæ¯è½¬å‘][8]
> [Objective-C Runtime][9]

### Method Swizzling

Method swizzling ç”¨äºæ”¹å˜ä¸€ä¸ªå·²ç»å­˜åœ¨çš„ selector çš„å®ç°ã€‚è¿™é¡¹æŠ€æœ¯ä½¿å¾—åœ¨è¿è¡Œæ—¶é€šè¿‡æ”¹å˜ selector åœ¨ç±»çš„æ¶ˆæ¯åˆ†å‘åˆ—è¡¨ä¸­çš„æ˜ å°„ä»è€Œæ”¹å˜æ–¹æ³•çš„æ‰ç”¨æˆä¸ºå¯èƒ½ã€‚

**swizzling åº”è¯¥åªåœ¨ dispatch_once ä¸­å®Œæˆ**
ç”±äº swizzling æ”¹å˜äº†å…¨å±€çš„çŠ¶æ€ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ç¡®ä¿æ¯ä¸ªé¢„é˜²æªæ–½åœ¨è¿è¡Œæ—¶éƒ½æ˜¯å¯ç”¨çš„ã€‚åŸå­æ“ä½œå°±æ˜¯è¿™æ ·ä¸€ä¸ªç”¨äºç¡®ä¿ä»£ç åªä¼šè¢«æ‰§è¡Œä¸€æ¬¡çš„é¢„é˜²æªæ–½ï¼Œå°±ç®—æ˜¯åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­ä¹Ÿèƒ½ç¡®ä¿ä»£ç åªæ‰§è¡Œä¸€æ¬¡ã€‚Grand Central Dispatch çš„ dispatch_once æ»¡è¶³äº†æ‰€éœ€è¦çš„éœ€æ±‚ï¼Œå¹¶ä¸”åº”è¯¥è¢«å½“åšä½¿ç”¨ swizzling çš„åˆå§‹åŒ–å•ä¾‹æ–¹æ³•çš„æ ‡å‡†ã€‚

å®ç°çš„ä»£ç å¯ä»¥å‚è€ƒ [Method Swizzling][3] ã€‚

### Associated Objects

åœ¨åˆ†ç±»ä¸­ @property å¹¶ä¸ä¼šè‡ªåŠ¨ç”Ÿæˆå®ä¾‹å˜é‡ä»¥åŠå­˜å–æ–¹æ³•ï¼Œæ‰€ä»¥ä¸€èˆ¬ä½¿ç”¨å…³è”å¯¹è±¡ä¸ºå·²ç»å­˜åœ¨çš„ç±»æ·»åŠ ã€Œå±æ€§ã€ã€‚

æˆ‘ä»¬ä½¿ç”¨äº†ä¸¤ä¸ªæ–¹æ³• `objc_getAssociatedObject` ä»¥åŠ `objc_setAssociatedObject` æ¥æ¨¡æ‹Ÿã€Œå±æ€§ã€çš„å­˜å–æ–¹æ³•ï¼Œè€Œä½¿ç”¨å…³è”å¯¹è±¡æ¨¡æ‹Ÿå®ä¾‹å˜é‡ã€‚ä½¿ç”¨ @selector(categoryProperty) (å³ `_cmd`) ä½œä¸º key ä¼ å…¥ã€‚å› ä¸ºè¿™ç§æ–¹æ³•çœç•¥äº†å£°æ˜å‚æ•°çš„ä»£ç ï¼Œå¹¶ä¸”èƒ½å¾ˆå¥½åœ°ä¿è¯ key çš„å”¯ä¸€æ€§ã€‚

åœ¨åˆ†ç±»ä¸­ï¼Œå› ä¸ºç±»çš„å®ä¾‹å˜é‡çš„å¸ƒå±€å·²ç»å›ºå®šï¼Œä½¿ç”¨ @property å·²ç»æ— æ³•å‘å›ºå®šçš„å¸ƒå±€ä¸­æ·»åŠ æ–°çš„å®ä¾‹å˜é‡ï¼ˆè¿™æ ·åšå¯èƒ½ä¼šè¦†ç›–å­ç±»çš„å®ä¾‹å˜é‡ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä½¿ç”¨å…³è”å¯¹è±¡ä»¥åŠä¸¤ä¸ªæ–¹æ³•æ¥æ¨¡æ‹Ÿæ„æˆå±æ€§çš„ä¸‰ä¸ªè¦ç´ ã€‚

å‡½æ•° `objc_removeAssociatedObjects` çš„ä¸»è¦ç›®çš„æ˜¯åœ¨ã€Œåˆå§‹çŠ¶æ€ã€æ—¶æ–¹ä¾¿åœ°è¿”å›ä¸€ä¸ªå¯¹è±¡ã€‚ä½ ä¸åº”è¯¥ç”¨è¿™ä¸ªå‡½æ•°æ¥åˆ é™¤å¯¹è±¡çš„å±æ€§ï¼Œå› ä¸ºå¯èƒ½ä¼šå¯¼è‡´å…¶ä»–å®¢æˆ·å¯¹å…¶æ·»åŠ çš„å±æ€§ä¹Ÿè¢«ç§»é™¤äº†ã€‚è§„èŒƒçš„æ–¹æ³•æ˜¯ï¼šè°ƒç”¨ `objc_setAssociatedObject` æ–¹æ³•å¹¶ä¼ å…¥ä¸€ä¸ª nil å€¼æ¥æ¸…é™¤ä¸€ä¸ªå…³è”ã€‚[å¯ä»¥çœ‹è¿™é‡Œ][6]ã€‚

å…³è”å¯¹è±¡åº”ç”¨å®ä¾‹ï¼š[åŠ¨æ€ä¿®æ”¹UINavigationBarçš„èƒŒæ™¯è‰²][7]ã€‚

*ä¸æ‡‚å¾…å¡«*ï¼š~~åˆ›å»ºä¸€ä¸ªç”¨äº KVO çš„å…³è”è§‚å¯Ÿè€…~~

### æ¶ˆæ¯è½¬å‘

è¯»ä¸€ä¸‹è¿™ä¸€ç¯‡æ–‡ç« [è½»æ¾å­¦ä¹ ä¹‹ä¸€ï¼ï¼Objective-Cæ¶ˆæ¯è½¬å‘][8]ï¼Œç®€å•æ˜“æ‡‚ã€‚

å¾ˆå¤šæƒ…å†µä¸‹ï¼Œç¨‹åºä¼šåœ¨è¿è¡Œæ—¶æŒ‚æ‰å¹¶æŠ›å‡º unrecognized selector sent to â€¦ çš„å¼‚å¸¸ã€‚ä½†åœ¨å¼‚å¸¸æŠ›å‡ºå‰ï¼ŒObjective-C çš„è¿è¡Œæ—¶ä¼šç»™ä½ ä¸‰æ¬¡æ‹¯æ•‘ç¨‹åºçš„æœºä¼šï¼š

* Method resolution
    `+ (BOOL)resolveInstanceMethod:(SEL)sel`
    `+ (BOOL)resolveClassMethod:(SEL)sel`

* Fast forwarding
    `- (id)forwardingTargetForSelector:(SEL)aSelector`

* Normal forwarding
    `- (NSMethodSignature *)methodSignatureForSelector:(SEL)aSelector`ï¼šå¦‚æœ `-methodSignatureForSelector:` è¿”å› nil ï¼Œruntime åˆ™ä¼šå‘å‡º `-doesNotRecognizeSelector:` æ¶ˆæ¯ï¼Œç¨‹åºè¿™æ—¶ä¹Ÿå°±æŒ‚æ‰äº†
    `- (void)forwardInvocation:(NSInvocation *)anInvocation`


Objective-C ä¸­ç»™ä¸€ä¸ªå¯¹è±¡å‘é€æ¶ˆæ¯ä¼šç»è¿‡ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š

1. åœ¨å¯¹è±¡ç±»çš„ dispatch table ä¸­å°è¯•æ‰¾åˆ°è¯¥æ¶ˆæ¯ã€‚å¦‚æœæ‰¾åˆ°äº†ï¼Œè·³åˆ°ç›¸åº”çš„å‡½æ•°IMPå»æ‰§è¡Œå®ç°ä»£ç ï¼›
2. å¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œruntime ä¼šå‘é€ `+ resolveInstanceMethod:` æˆ–è€… `+ resolveClassMethod:` å°è¯•å» resolve è¿™ä¸ªæ¶ˆæ¯ï¼›
3. å¦‚æœ resolve æ–¹æ³•è¿”å› NOï¼Œruntime å°±å‘é€ `- forwardingTargetForSelector:` å…è®¸ä½ æŠŠè¿™ä¸ªæ¶ˆæ¯è½¬å‘ç»™å¦ä¸€ä¸ªå¯¹è±¡ï¼›
4. å¦‚æœæ²¡æœ‰æ–°çš„ç›®æ ‡å¯¹è±¡è¿”å›ï¼Œ runtime å°±ä¼šå‘é€ `- methodSignatureForSelector:` å’Œ `- forwardInvocation:` æ¶ˆæ¯ã€‚ä½ å¯ä»¥å‘é€ `- invokeWithTarget:` æ¶ˆæ¯æ¥æ‰‹åŠ¨è½¬å‘æ¶ˆæ¯æˆ–è€…å‘é€ `- doesNotRecognizeSelector:` æŠ›å‡ºå¼‚å¸¸ã€‚

## Category
> [æ·±å…¥ç†è§£Objective-Cï¼šCategory][10]
> [objc categoryçš„ç§˜å¯†][11]

* å¯ä»¥æŠŠç±»çš„å®ç°åˆ†å¼€åœ¨å‡ ä¸ªä¸åŒçš„æ–‡ä»¶é‡Œé¢ã€‚è¿™æ ·åšæœ‰å‡ ä¸ªæ˜¾è€Œæ˜“è§çš„å¥½å¤„ï¼š
    * å¯ä»¥å‡å°‘å•ä¸ªæ–‡ä»¶çš„ä½“ç§¯
    * å¯ä»¥æŠŠä¸åŒçš„åŠŸèƒ½ç»„ç»‡åˆ°ä¸åŒçš„ category é‡Œ
    * å¯ä»¥ç”±å¤šä¸ªå¼€å‘è€…å…±åŒå®Œæˆä¸€ä¸ªç±»
    * å¯ä»¥æŒ‰éœ€åŠ è½½æƒ³è¦çš„category
* å£°æ˜ç§æœ‰æ–¹æ³•
* æ¨¡æ‹Ÿå¤šç»§æ‰¿
* æŠŠ framework çš„ç§æœ‰æ–¹æ³•å…¬å¼€

extension åœ¨ç¼–è¯‘æœŸå†³è®®ï¼Œå®ƒå°±æ˜¯ç±»çš„ä¸€éƒ¨åˆ†ï¼Œåœ¨ç¼–è¯‘æœŸå’Œå¤´æ–‡ä»¶é‡Œçš„ @interface ä»¥åŠå®ç°æ–‡ä»¶é‡Œçš„ @implementation ä¸€èµ·å½¢æˆä¸€ä¸ªå®Œæ•´çš„ç±»ï¼Œå®ƒä¼´éšç±»çš„äº§ç”Ÿè€Œäº§ç”Ÿï¼Œäº¦éšä¹‹ä¸€èµ·æ¶ˆäº¡ã€‚extension ä¸€èˆ¬ç”¨æ¥éšè—ç±»çš„ç§æœ‰ä¿¡æ¯ï¼Œä½ å¿…é¡»æœ‰ä¸€ä¸ªç±»çš„æºç æ‰èƒ½ä¸ºä¸€ä¸ªç±»æ·»åŠ  extensionï¼Œæ‰€ä»¥ä½ æ— æ³•ä¸ºç³»ç»Ÿçš„ç±»æ¯”å¦‚ NSString æ·»åŠ  extensionã€‚

ä½†æ˜¯ category åˆ™å®Œå…¨ä¸ä¸€æ ·ï¼Œå®ƒæ˜¯åœ¨è¿è¡ŒæœŸå†³è®®çš„ã€‚
å°± category å’Œ extension çš„åŒºåˆ«æ¥çœ‹ï¼Œæˆ‘ä»¬å¯ä»¥æ¨å¯¼å‡ºä¸€ä¸ªæ˜æ˜¾çš„äº‹å®ï¼Œextension å¯ä»¥æ·»åŠ å®ä¾‹å˜é‡ï¼Œè€Œ category æ˜¯æ— æ³•æ·»åŠ å®ä¾‹å˜é‡çš„ï¼ˆå› ä¸ºåœ¨è¿è¡ŒæœŸï¼Œå¯¹è±¡çš„å†…å­˜å¸ƒå±€å·²ç»ç¡®å®šï¼Œå¦‚æœæ·»åŠ å®ä¾‹å˜é‡å°±ä¼šç ´åç±»çš„å†…éƒ¨å¸ƒå±€ï¼Œè¿™å¯¹ç¼–è¯‘å‹è¯­è¨€æ¥è¯´æ˜¯ç¾éš¾æ€§çš„ï¼‰ã€‚

æ€ä¹ˆè°ƒç”¨åˆ°åŸæ¥ç±»ä¸­è¢« category è¦†ç›–æ‰çš„æ–¹æ³•ï¼Ÿ
å¯¹äºè¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“ category å…¶å®å¹¶ä¸æ˜¯å®Œå…¨æ›¿æ¢æ‰åŸæ¥ç±»çš„åŒåæ–¹æ³•ï¼Œåªæ˜¯ category åœ¨æ–¹æ³•åˆ—è¡¨çš„å‰é¢è€Œå·²ï¼Œæ‰€ä»¥æˆ‘ä»¬åªè¦é¡ºç€æ–¹æ³•åˆ—è¡¨æ‰¾åˆ°æœ€åä¸€ä¸ªå¯¹åº”åå­—çš„æ–¹æ³•ã€‚

## iOS å†…å­˜ç®¡ç†
> [ç†è§£ iOS çš„å†…å­˜ç®¡ç†][12]

**å¼±å¼•ç”¨çš„å®ç°åŸç†**

å¼±å¼•ç”¨çš„å®ç°åŸç†æ˜¯è¿™æ ·ï¼Œç³»ç»Ÿå¯¹äºæ¯ä¸€ä¸ªæœ‰å¼±å¼•ç”¨çš„å¯¹è±¡ï¼Œéƒ½ç»´æŠ¤ä¸€ä¸ªè¡¨æ¥è®°å½•å®ƒæ‰€æœ‰çš„å¼±å¼•ç”¨çš„æŒ‡é’ˆåœ°å€ã€‚è¿™æ ·ï¼Œå½“ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨è®¡æ•°ä¸º 0 æ—¶ï¼Œç³»ç»Ÿå°±é€šè¿‡è¿™å¼ è¡¨ï¼Œæ‰¾åˆ°æ‰€æœ‰çš„å¼±å¼•ç”¨æŒ‡é’ˆï¼Œç»§è€ŒæŠŠå®ƒä»¬éƒ½ç½®æˆ nilã€‚

ä»è¿™ä¸ªåŸç†ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œå¼±å¼•ç”¨çš„ä½¿ç”¨æ˜¯æœ‰é¢å¤–çš„å¼€é”€çš„ã€‚è™½ç„¶è¿™ä¸ªå¼€é”€å¾ˆå°ï¼Œä½†æ˜¯å¦‚æœä¸€ä¸ªåœ°æ–¹æˆ‘ä»¬è‚¯å®šå®ƒä¸éœ€è¦å¼±å¼•ç”¨çš„ç‰¹æ€§ï¼Œå°±ä¸åº”è¯¥ç›²ç›®ä½¿ç”¨å¼±å¼•ç”¨ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œæœ‰äººå–œæ¬¢åœ¨æ‰‹å†™ç•Œé¢çš„æ—¶å€™ï¼Œå°†æ‰€æœ‰ç•Œé¢å…ƒç´ éƒ½è®¾ç½®æˆ weak çš„ï¼Œè¿™æŸç§ç¨‹åº¦ä¸Šä¸ Xcode é€šè¿‡ Storyboard æ‹–æ‹½ç”Ÿæˆçš„æ–°å˜é‡æ˜¯ä¸€è‡´çš„ã€‚ä½†æ˜¯æˆ‘ä¸ªäººè®¤ä¸ºè¿™æ ·åšå¹¶ä¸å¤ªåˆé€‚ã€‚å› ä¸ºï¼š

1. æˆ‘ä»¬åœ¨åˆ›å»ºè¿™ä¸ªå¯¹è±¡æ—¶ï¼Œéœ€è¦æ³¨æ„ä¸´æ—¶ä½¿ç”¨ä¸€ä¸ªå¼ºå¼•ç”¨æŒæœ‰å®ƒï¼Œå¦åˆ™å› ä¸º weak å˜é‡å¹¶ä¸æŒæœ‰å¯¹è±¡ï¼Œå°±ä¼šé€ æˆä¸€ä¸ªå¯¹è±¡åˆšè¢«åˆ›å»ºå°±é”€æ¯æ‰ã€‚
2. å¤§éƒ¨åˆ† ViewController çš„è§†å›¾å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸä¸ ViewController æœ¬èº«æ˜¯ä¸€è‡´çš„ï¼Œæ²¡æœ‰å¿…è¦é¢å¤–åšè¿™ä¸ªäº‹æƒ…ã€‚
3. æ—©å…ˆè‹¹æœè¿™ä¹ˆè®¾è®¡ï¼Œæ˜¯æœ‰å†å²åŸå› çš„ã€‚åœ¨æ—©å¹´ï¼Œå½“æ—¶ç³»ç»Ÿæ”¶åˆ° Memory Warning çš„æ—¶å€™ï¼ŒViewController çš„ View ä¼šè¢« unLoad æ‰ã€‚è¿™ä¸ªæ—¶å€™ï¼Œä½¿ç”¨ weak çš„è§†å›¾å˜é‡æ˜¯æœ‰ç”¨çš„ï¼Œå¯ä»¥ä¿æŒè¿™äº›å†…å­˜è¢«å›æ”¶ã€‚ä½†æ˜¯è¿™ä¸ªè®¾è®¡å·²ç»è¢«åºŸå¼ƒäº†ï¼Œæ›¿ä»£æ–¹æ¡ˆæ˜¯å°†ç›¸å…³è§†å›¾çš„ CALayer å¯¹åº”çš„ CABackingStore ç±»å‹çš„å†…å­˜åŒºä¼šè¢«æ ‡è®°æˆ volatile ç±»å‹ã€‚

## UIWindow
> [åˆ†æUIWindow][13]
> [UIWindow - Apple Developer][14]
> [View Programming Guide for iOS][15]

UIWindow ä¸€æ—¦è¢«åˆ›å»ºå°±ä¼šè¢«æ·»åŠ åˆ°æ•´ä¸ªç•Œé¢ä¸Šã€‚Xcode åˆ›å»ºçš„æ–°é¡¹ç›®ä½¿ç”¨ Storyboardï¼ŒStoryboard éœ€è¦ä½¿ç”¨ AppDelegate æä¾›çš„ window å¯¹è±¡ï¼ŒXcode åˆ›å»ºçš„æ¨¡ç‰ˆè‡ªåŠ¨æä¾›è¯¥ windowã€‚Window ä¸å±•ç¤ºè‡ªèº«ï¼Œé€šå¸¸ä¿ç•™ rootViewController çš„ viewã€‚ä¸ä½¿ç”¨ Storyboard çš„é¡¹ç›®éœ€è¦æ‰‹åŠ¨åˆ›å»º UIWindow å¯¹è±¡ï¼Œè®© AppDelegate å¼•ç”¨è¿™ä¸ªå¯¹è±¡ï¼Œå¹¶è°ƒç”¨ `-makeKeyAndVisible` è®¾æˆ app çš„ keyWindowã€‚

æ¯ä¸€ä¸ª controller éƒ½ä¼šè¢« UIWindow æ¥ç®¡ï¼ŒUIWindow ä¸€æ¬¡åªèƒ½æ¥ç®¡ä¸€ä¸ª controllerã€‚

UIWindow ä¼šåœ¨ä¸€ä¸ª controller çš„ `- viewDidAppear` æ–¹æ³•ä¸­æ‰æ¥ç®¡äº†å½“å‰ controllerï¼Œè€Œä¸æ˜¯åœ¨`- viewDidLoad` æ–¹æ³•ä¸­ã€‚

UIWindow æœ‰ç€æ¯”ä¸€åˆ‡ controller éƒ½è¦é«˜çš„ä¼˜å…ˆçº§æ˜¾ç¤ºæƒåˆ©ï¼ŒåŠ è½½åœ¨ UIWindow ä¸Šé¢çš„ View æ˜¯ä¸ä¼šè¢«é®æŒ¡ä½çš„ã€‚keyWindow æ˜¯æŒ‡å®šçš„ç”¨æ¥æ¥æ”¶é”®ç›˜ä»¥åŠéè§¦æ‘¸ç±»çš„æ¶ˆæ¯ï¼Œè€Œä¸”ç¨‹åºä¸­æ¯ä¸€ä¸ªæ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ª window æ˜¯ keyWindowã€‚

UIWindowçš„ä¸»è¦åŠŸèƒ½ï¼š

* æä¾›ä¸€ä¸ªåŒºåŸŸæ¥æ˜¾ç¤º views
* å‘é€ events ç»™ views

[1]: http://draveness.me/load/
[2]: http://draveness.me/initialize/
[3]: http://nshipster.cn/method-swizzling/
[4]: http://nshipster.cn/associated-objects/
[5]: http://draveness.me/ao/
[6]: http://weibo.com/3321824014/EcKe666en?type=comment/
[7]: http://tech.glowing.com/cn/change-uinavigationbar-backgroundcolor-dynamically/
[8]: http://www.jianshu.com/p/1bde36ad9938/
[9]: http://tech.glowing.com/cn/objective-c-runtime/
[10]: http://tech.meituan.com/DiveIntoCategory.html
[11]: http://blog.sunnyxx.com/2014/03/05/objc_category_secret/
[12]: http://blog.devtang.com/2016/07/30/ios-memory-management/
[13]: http://www.cnblogs.com/YouXianMing/p/3811741.html
[14]: https://developer.apple.com/documentation/uikit/uiwindow?language=objc
[15]: https://developer.apple.com/library/content/documentation/WindowsViews/Conceptual/ViewPG_iPhoneOS/CreatingWindows/CreatingWindows.html
